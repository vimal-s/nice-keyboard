<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>Key Drum</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="keys">
    <div class="group">
      <div class="key" data-key="q 81">
        <kbd>q</kbd>
        <span class="sound">clap</span>
      </div>
      <div class="key" data-key="w 87">
        <kbd>w</kbd>
        <span class="sound">hihat</span>
      </div>
      <div class="key" data-key="e 69">
        <kbd>e</kbd>
        <span class="sound">kick</span>
      </div>
      <div class="key" data-key="r 82">
        <kbd>r</kbd>
        <span class="sound">openhat</span>
      </div>
      <div class="key" data-key="t 84">
        <kbd>t</kbd>
        <span class="sound">boom</span>
      </div>
      <div class="key" data-key="y 89">
        <kbd>y</kbd>
        <span class="sound">ride</span>
      </div>
      <div class="key" data-key="u 85">
        <kbd>u</kbd>
        <span class="sound">snare</span>
      </div>
      <div class="key" data-key="i 73">
        <kbd>i</kbd>
        <span class="sound">tom</span>
      </div>
      <div class="key" data-key="o 79">
        <kbd>o</kbd>
        <span class="sound">tink</span>
      </div>
      <div class="key" data-key="p 80">
        <kbd>p</kbd>
        <span class="sound">clap</span>
      </div>
    </div>

    <div class="group">
      <div class="key" data-key="a 65">
        <kbd>a</kbd>
        <span class="sound">clap</span>
      </div>
      <div class="key" data-key="s 83">
        <kbd>s</kbd>
        <span class="sound">hihat</span>
      </div>
      <div class="key" data-key="d 68">
        <kbd>d</kbd>
        <span class="sound">kick</span>
      </div>
      <div class="key" data-key="f 70">
        <kbd>f</kbd>
        <span class="sound">openhat</span>
      </div>
      <div class="key" data-key="g 71">
        <kbd>g</kbd>
        <span class="sound">boom</span>
      </div>
      <div class="key" data-key="h 72">
        <kbd>h</kbd>
        <span class="sound">ride</span>
      </div>
      <div class="key" data-key="j 74">
        <kbd>j</kbd>
        <span class="sound">snare</span>
      </div>
      <div class="key" data-key="k 75">
        <kbd>k</kbd>
        <span class="sound">tom</span>
      </div>
      <div class="key" data-key="l 76">
        <kbd>l</kbd>
        <span class="sound">tink</span>
      </div>
    </div>

    <div class="group">
      <div class="key" data-key="z 90">
        <kbd>z</kbd>
        <span class="sound">clap</span>
      </div>
      <div class="key" data-key="x 88">
        <kbd>x</kbd>
        <span class="sound">hihat</span>
      </div>
      <div class="key" data-key="c 67">
        <kbd>c</kbd>
        <span class="sound">kick</span>
      </div>
      <div class="key" data-key="v 86">
        <kbd>v</kbd>
        <span class="sound">openhat</span>
      </div>
      <div class="key" data-key="b 66">
        <kbd>b</kbd>
        <span class="sound">boom</span>
      </div>
      <div class="key" data-key="n 78">
        <kbd>n</kbd>
        <span class="sound">ride</span>
      </div>
      <div class="key" data-key="m 77">
        <kbd>m</kbd>
        <span class="sound">snare</span>
      </div>
      <div class="key" data-key="k">
        <kbd></kbd>
        <span class="sound"></span>
      </div>
    </div>
  </div>

  <audio src="sounds/A3vH.wav" data-key="q 81"></audio>
  <audio src="sounds/A4vH.wav" data-key="w "></audio>
  <audio src="sounds/A5vH.wav" data-key="e "></audio>
  <audio src="sounds/A6vH.wav" data-key="r"></audio>
  <audio src="sounds/A7vH.wav" data-key="t"></audio>
  <audio src="sounds/B1vH.wav" data-key="y"></audio>
  <audio src="sounds/B2vH.wav" data-key="u"></audio>
  <audio src="sounds/B7vH.wav" data-key="i"></audio>
  <audio src="sounds/C1vH.wav" data-key="o"></audio>
  <audio src="sounds/C4vH.wav" data-key="p"></audio>
  <audio src="sounds/C5vh.wav" data-key="a"></audio>
  <audio src="sounds/C6vH.wav" data-key="s"></audio>
  <audio src="sounds/C7vH.wav" data-key="d"></audio>
  <audio src="sounds/D%232vH.wav" data-key="f"></audio>
  <audio src="sounds/D%233vH.wav" data-key="g"></audio>
  <audio src="sounds/D%234vH.wav" data-key="h"></audio>
  <audio src="sounds/D%235vH.wav" data-key="j"></audio>
  <audio src="sounds/D%236vH.wav" data-key="k"></audio>
  <audio src="sounds/D%237vH.wav" data-key="l"></audio>
  <audio src="sounds/F%231vH.wav" data-key="z"></audio>
  <audio src="sounds/F%232vH.wav" data-key="x"></audio>
  <audio src="sounds/F%233vH.wav" data-key="c"></audio>
  <audio src="sounds/F%234vH.wav" data-key="v"></audio>
  <audio src="sounds/F%235vH.wav" data-key="b"></audio>
  <audio src="sounds/F%236vH.wav" data-key="n"></audio>
  <audio src="sounds/F%237vH.wav" data-key="m"></audio>
  <audio src="sounds/clap.wav" data-key=""></audio>

  <script>
    function playSound(event) {
      // play sound
      // console.log(event);
      let query1 = 'audio[data-key~="' + event.key + '"]';
      let query2 = 'audio[data-key~="' + event.keyCode + '"]';
      const audio = document.querySelector(query1) || document.querySelector(query2);

      if (!audio) {
        return;
      }
      // audio.load(); // works but not fast enough compared to currentTime
      // audio.currentTime = 0;
      audio.play();

      // play transition
      query1 = `.key[data-key~="${event.key}"]`;
      query2 = '.key[data-key~="' + event.keyCode + '"]';
      const key = document.querySelector(query1) || document.querySelector(query2);
      key.classList.add('playing');
    }

    function removeTransition(event) {
      if (event.propertyName !== 'transform' || !event.target.classList.contains('playing')) {
        return;
      }
      
      event.target.classList.remove('playing');
    }

    // document.addEventListener('keydown', event => {
    //   console.log(event.keyCode);
    // });
    document.onkeydown = playSound;

    // const keys = document.querySelectorAll('.key');  // no need to call every child
    // keys.forEach(key => key.ontransitionend = removeTransition);
    const keys = document.querySelector('.keys'); // called on parent will work because of bubbling
    keys.ontransitionend = removeTransition;
  </script>
</body>

</html>
